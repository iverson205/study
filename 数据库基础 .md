---
title: 数据库基础
tags: Java,SQL,数据库
grammar_cjkRuby: true
---

# 1.用Java操作数据库
 在使用Java进行数据库开发的最初阶段，都是使用JDBC类来操作数据库的。该方法主要分为以下几个步骤：
### 1.1 定义查询或更新的SQL语句
### 1.2 加载数据库驱动
*   在连接数据库之前，首先要加载想要连接的数据库的驱动到JVM;
*  Class.forName("com.mysql.jdbc.Driver");
### 1.3  获取数据库连接
* 连接所用的URL的定义包括协议（jdbc）、子协议（mysql）、数据源标识；
* 向java.sql.DriverManager请求并获得Connection对象
````markdown
```java
String URL="jdbc.mysql.localhost:3306/lhdb?useUnicode=true&characterEncoding=gbk ; "//数据库名lhdb
String username="root";
String password="root";
try{
Connection conn=DriverManager.getConnection(URL,username,password);
}
catch(Exception e){
}
````
### 1.4创建申明对象

要执行SQL语句，必须获得java.sql.Statement实例，Statement实例分为以下3种类型：

      1、执行静态SQL语句。通常通过Statement实例实现。   
      2、执行动态SQL语句。通常通过PreparedStatement实例实现。   
      3、执行数据库存储过程。通常通过CallableStatement实例实现。
 ````markdown
 ```java
   Statement stmt = con.createStatement() ;   
   PreparedStatement pstmt = con.prepareStatement(sql) ;   
   CallableStatement cstmt =  con.prepareCall("{CALL demoSp(? , ?)}") ;   
  ````
### 1.5 执行SQL语句
   Statement接口提供了三种执行SQL语句的方法：
   * executeQuery(String sqlString)
    执行查询数据库的SQL语句   ，返回一个结果集（ResultSet）对象。  
    * executeUpdate(String sqlString)
    用于执行INSERT、UPDATE或 DELETE语句以及SQL DDL语句，如：CREATE TABLE和DROP TABLE等   
  * execute(sqlString)
  用于执行返回多个结果集、多个更新计数或二者组合的语句。
  ````markdown
  ```java
  ResultSet rs=stmt.excuteQuery(sql);
  int rows = stmt.executeUpdate("INSERT INTO ...") ;   
  boolean flag = stmt.execute(String sql) ;  
  ````
  
### 1.6 处理结果 
   * 执行更新返回更改的记录数
   * 执行查询返回的结果集
   
    ````markdown
   ```java
   while(rs.next())
   {
   		String name=rs.getString("name");
        String pd=rs.getString(1);//列号从1开始，较高效
   }
   ````
   
### 1.7 关闭结果集、申明对象和数据库连接

# 2.常用SQL语句
按照功能划分，可以分为数据定义语言（DDL）、数据查询语言（DQL）、数据操纵语言（DML）、数据控制语言（DCL）。用的最多的就是增、删、改、查。

* select
select [all|distinct] <目标表达式>[,<目标表达式>]……
from <表或视图>[,表或视图]……
[where <条件表达式>]
[group by <列名1>[having <条件表达式>]]
[order by <列名2>[desc|asc]]

* update
update 表名称 set 列名称=新值 where 列名称=某值

* insert
insert [into] tablename values(值1，值2，……)//插入全部值
insert [into] tablename(列1，列2，……）values(值1，值2，……）//插入部分值

* delete
delete from tables//删除所有行
delete from tablename where nane=‘张三’ //删除指定行

* 其他常用
show databases;//显示数据库名
use database；//切换到某个数据库
show tables;//显示该数据库下全部表名
create table 表名（
列名称1  数据类型，
列名称2  数据类型，
……
）//创建表

 # 3.数据类型
 在 MySQL 中，有三种主要的类型：文本、数字和日期/时间类型。
 
 * 文本
 1. char(size)/varchar(size):定长/可变定长
 2. tinytext/text/mediumtext/longtext:255(2^8^)/65535(2^16^)/……
 * 数字
1) tinyint(size)/smallint(size)/mediumint(size)/int(size)/bigint(size):分有符号和无符号两种取值范围
2) float/double（size,d）:在 d 参数中规定小数点右侧的最大位数
 * 日期
 date/datetime/timestamp/time/year
 
 # 4.应用
 [单表去重](https://leetcode.com/problems/delete-duplicate-emails/)
  [第n名](https://leetcode.com/problems/nth-highest-salary/)
  [多表联查](https://leetcode.com/problems/department-highest-salary/)
  # 5.数据库事务
数据库事务是指作为单个逻辑工作单元执行的一系列操作，这些操作要么全做，要么全不做，是一个不可分割的工作单位。
事务的主要特点包括：原子性、一致性、独立性、持久性。

* 原子性：事务必须是原子工作单元；对于其数据修改，要么全都执行，要么全都不执行。比如银行存款，存折减款和拿到现在要同时完成。
* 一致性：事务在完成时，必须使所有的数据都保持一致状态（满足所有的完整性约束）。比如完整性约束了a+b=10,一个事务改变了b，那么a也随之改变。
* 独立性：事务查看数据时数据所处的状态，要么是另一并发事务修改它之前的状态，要么是另一事务修改它之后的状态，事务不会查看中间状态的数据，这称为独立性。
* 持久性：事务完成之后，它对于系统的影响是永久性的。该修改即使出现致命的系统故障也将一直保持。

## 事务隔离级别
读未提交<读提交<重复读<序列化

  类别 | 脏读|不可重复读|幻读
------------- | ------------- | ------------- | -------------
读未提交 |Y|Y|Y
读提交 |N|Y|Y
重复读 |N|N|Y
幻读 |N|N|N

* 脏读
事务1更新了记录，但没有提交，事务2读取了更新后的行，然后事务T1回滚，现在T2读取无效。

* 不可重复读
事务1读取记录时，事务2**更新**了记录并提交，事务1再次读取时可以看到事务2修改后的记录。

* 幻读
事务1读取记录时事务2**增加**了记录并提交，事务1再次读取时可以看到事务2新增的记录。

* 其他
与不可重复读的区别是：在幻读中，已经读取的数据不会改变，只是与以前相比，会有更多的数据满足查询条件。
大多数数据库的默认级别就是Read committed，比如Sql Server , Oracle。
Mysql的默认隔离级别就是Repeatable read。

